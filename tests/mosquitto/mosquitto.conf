per_listener_settings true

################################
# Anonymous
################################
listener 1883
allow_anonymous true

################################
# Bearer token (JWT) - Not currently tested since plugin is archived and up-to-date plugin was hard to find.
################################
# listener 1884
# allow_anonymous false

# # Use a plugin for bearer/JWT auth
# auth_plugin /mosquitto/plugins/mosquitto-go-auth.so
# auth_opt_backends jwt
# auth_opt_jwt_key_file /mosquitto/config/jwt_public.pem
# auth_opt_jwt_alg RS256

################################
# Certificate authentication
################################
listener 8883
allow_anonymous false
cafile /mosquitto/certs/ca.crt
certfile /mosquitto/certs/server.crt
keyfile /mosquitto/certs/server.key
require_certificate true
use_identity_as_username true # CN of certificate becomes the MQTT username
